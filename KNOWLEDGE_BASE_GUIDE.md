# 바로빌 챗봇 지식베이스 관리 가이드

## 목차
1. [JSON 데이터 직접 관리 가이드](#json-데이터-직접-관리-가이드)
2. [Admin 페이지 사용 가이드](#admin-페이지-사용-가이드)
3. [자주묻는질문(FAQ) 관리 가이드](#자주묻는질문faq-관리-가이드)
4. [상황별 Case 항목 작성 가이드](#상황별-case-항목-작성-가이드)
5. [어투별 답변 작성 가이드](#어투별-답변-작성-가이드)
6. [우선순위(Priority) 구동 방식 상세 설명](#우선순위priority-구동-방식-상세-설명)
7. [날짜 패턴 추출 및 신고 마감일 계산](#날짜-패턴-추출-및-신고-마감일-계산)
8. [검색 품질 향상 가이드 (Advanced)](#검색-품질-향상-가이드-advanced)
9. [답변 포맷팅 및 리치 콘텐츠 가이드](#답변-포맷팅-및-리치-콘텐츠-가이드)
10. [피드백 기능 사용 가이드](#피드백-기능-사용-가이드)
11. [개선점 및 향후 계획](#개선점-및-향후-계획)

---

## JSON 데이터 직접 관리 가이드

### 파일 위치
```
src/data/barobill-knowledge.json
```

### 기본 구조 이해

```json
{
  "metadata": {
    "version": "버전 번호",
    "updated_at": "업데이트 날짜",
    "description": "설명"
  },
  "synonyms": {
    "대표어": ["동의어1", "동의어2", "동의어3"]
  },
  "items": [
    {
      "id": "고유ID",
      "type": "intent | knowledge | case",
      "category": "카테고리명",
      "title": "질문 제목",
      "keywords": ["키워드1", "키워드2"],
      "priority": 1-10,
      "responses": {
        "formal": "격식체 답변",
        "casual": "해요체 답변",
        "informal": "반말 답변",
        "plain": "평어체 답변"
      }
    }
  ]
}
```

### 항목 추가 방법

#### 1. 새 항목 추가 예시

```json
{
  "id": "case_return_2025_11_20",
  "type": "case",
  "category": "수정세금계산서",
  "title": "2025년 11월 20일 거래분 반품 처리",
  "keywords": ["2025년 11월 20일", "11월 20일", "반품", "환입"],
  "priority": 9,
  "responses": {
    "formal": "2025년 11월 20일자 세금계산서의 경우...",
    "casual": "2025년 11월 20일에 끊은 거지? 신고 기간 아직 안 지났으면...",
    "informal": "2025년 11월 20일에 끊은 거야? 신고 기간 아직 안 지났으면...",
    "plain": "2025년 11월 20일 거래분의 경우, 신고 마감 전이라면..."
  }
}
```

---

## Admin 페이지 사용 가이드

### 접근 방법

1. **웹 브라우저에서 직접 접근:**
   ```
   http://localhost:8080/admin
   ```
   또는
   ```
   https://your-domain.com/admin
   ```

2. **메인 페이지에서 접근:**
   - 메인 페이지 우측 하단의 "지식베이스 관리" 버튼 클릭

### 주요 기능

#### 1. 항목 추가
- "새 항목 추가" 버튼 클릭
- **필수 항목 입력:**
  - 유형 (Intent/Knowledge/Case)
  - 카테고리
  - 제목
  - Formal 답변
- **선택 항목:**
  - 설명
  - 우선순위 (1-10)
  - 키워드
  - Casual/Informal/Plain 답변

#### 2. 항목 수정
- 항목 목록에서 수정할 항목 찾기
- 연필 아이콘 클릭
- 내용 수정 후 "저장" 클릭

#### 3. 항목 삭제
- 항목 목록에서 삭제할 항목 찾기
- 휴지통 아이콘 클릭
- 확인 대화상자에서 "확인" 클릭

#### 4. JSON 다운로드
- "JSON 다운로드" 버튼 클릭
- 수정된 내용이 포함된 JSON 파일 다운로드
- 파일명: `barobill-knowledge-YYYY-MM-DD.json`

#### 5. 검색 및 필터
- **검색창:** 제목이나 키워드로 검색
- **유형 필터:** Intent/Knowledge/Case 선택

---

## 자주묻는질문(FAQ) 관리 가이드

### FAQ 항목 추가 방법

FAQ에 표시되려면 다음 조건을 만족해야 합니다:

1. `type`이 `"knowledge"` 또는 `"case"`여야 함
2. `category`는 FAQ 탭에서 필터링에 사용됨

### FAQ 항목 예시

```json
{
  "id": "faq_tax_issue_method",
  "type": "knowledge",
  "category": "자주묻는질문",
  "title": "세금계산서 발급은 어떻게 하나요?",
  "keywords": ["발급", "방법", "어떻게", "절차"],
  "priority": 8,
  "responses": {
    "formal": "세금계산서 발급은 [매출문서 작성] 메뉴에서 가능합니다...",
    "casual": "세금계산서 발급? [매출문서 작성] 메뉴에서 하면 돼요!",
    "informal": "세금계산서 발급? [매출문서 작성] 메뉴에서 하면 돼!",
    "plain": "세금계산서 발급은 [매출문서 작성] 메뉴에서 진행함."
  }
}
```

### FAQ 카테고리 관리

현재 FAQ 섹션은 다음 카테고리로 필터링됩니다:
- 세금계산서
- 수정세금계산서
- 부가가치세
- 인증서
- 바로빌서비스
- 세무정보
- 자주묻는질문

**새 카테고리를 추가하려면:**
1. 항목의 `category` 필드에 새 카테고리명 입력
2. FAQ 섹션의 탭에 자동으로 추가됨

---

## 상황별 Case 항목 작성 가이드

### 날짜 패턴 인식

다양한 날짜 표현을 키워드에 포함:

```json
"keywords": [
  "2025년 10월 16일",
  "10월 16일",
  "2025-10-16",
  "2025/10/16",
  "10.16"
]
```

### Examples 필드 활용

구체적 상황 예시 추가:

```json
"examples": [
  {
    "situation": "2025년 10월 16일 거래분 전액 반품",
    "solution": "수정세금계산서 > 환입 사유 선택 > 반품 금액 입력",
    "dateContext": "2025-10-16",
    "deadline": "2026-01-25"
  },
  {
    "situation": "2025년 10월 16일 거래분 일부(50만원) 반품",
    "solution": "수정세금계산서 > 환입 사유 선택 > 50만원만 입력"
  }
]
```

---

## 어투별 답변 작성 가이드

### Formal (격식체)
- **특징:** 존댓말, 격식 있는 표현
- **예시:** "~입니다", "~하십시오", "~하시면 됩니다"
- **사용 예:**
  ```
  "2025년 10월 16일자 세금계산서의 경우, 해당 세금 신고 마감기한이 지나지 않았다면 [환입] 사유로 수정세금계산서를 발행하시면 됩니다."
  ```

### Casual (해요체)
- **특징:** 친근한 존댓말
- **예시:** "~에요", "~해요", "~돼요", "~거예요"
- **사용 예:**
  ```
  "2025년 10월 16일에 끊은 거지? 신고 기간 아직 안 지났으면 [환입]으로 다시 끊으면 돼요! 🧾"
  ```

### Informal (반말)
- **특징:** 친근한 반말
- **예시:** "~야", "~해", "~돼", "~거야"
- **사용 예:**
  ```
  "2025년 10월 16일에 끊은 거야? 신고 기간 아직 안 지났으면 [환입]으로 다시 끊으면 돼! 🧾"
  ```

### Plain (평어체)
- **특징:** 설명조, 간결한 표현
- **예시:** "~함", "~임", "~됨", "~거임"
- **사용 예:**
  ```
  "2025년 10월 16일 거래분의 경우, 신고 마감 전이라면 [환입] 수정세금계산서 발급 대상임."
  ```

---

## 우선순위(Priority) 설정 가이드

- **10:** 인사/자기소개 (Intent)
- **9:** 중요한 상황별 Case (예: 특정 날짜 반품 처리)
- **8:** 일반적인 Case 또는 중요한 FAQ
- **7:** 일반적인 Case
- **5-6:** 일반적인 Knowledge
- **4:** 서비스 안내

---

## 우선순위(Priority) 구동 방식 상세 설명

### 점수 계산 공식

챗봇은 사용자의 질문과 지식베이스 항목을 매칭할 때 다음 공식을 사용합니다:

```
최종 점수 = (키워드 매칭 점수) + (제목 매칭 점수) + (우선순위)
```

### 상세 계산 방식

#### 1. 키워드 매칭 점수
- **점수:** 매칭된 키워드 1개당 **10점**
- **동작 방식:**
  - 질문에 포함된 키워드가 항목의 `keywords` 배열에 있으면 점수 부여
  - 동의어(synonyms) 확장도 적용됨
  - 예: 질문에 "반품"이 있고, 항목의 keywords에 "반품", "환입"이 있으면 → 20점

#### 2. 제목(Title) 정확도 가산점
- **점수:** 질문이 제목을 직접 포함하면 **20점**
- **동작 방식:**
  - 질문 텍스트에 항목의 `title`이 포함되어 있으면 가산점 부여
  - 예: 질문 "세금계산서 발급 방법" → 제목 "세금계산서 발급 방법"과 일치 → 20점

#### 3. 우선순위(Priority) 가산점
- **점수:** Priority 값 그대로 가산점으로 추가
- **동작 방식:**
  - Priority가 9인 항목은 9점 추가
  - Priority가 5인 항목은 5점 추가
  - **중요:** Priority만으로는 통과할 수 없음 (최소 15점 필요)

### 점수 계산 예시

**질문:** "2025년 11월 20일 거래분 반품 처리 어떻게 해?"

#### 항목 A: "반품(환입)에 의한 수정세금계산서" (priority: 8)
- 키워드 매칭: "반품" (10점) + "환입" (10점) = **20점**
- 제목 매칭: 없음 = **0점**
- 우선순위: **8점**
- **총점: 28점**

#### 항목 B: "2025년 11월 20일 거래분 반품 처리" (priority: 9)
- 키워드 매칭: "2025년 11월 20일" (10점) + "11월 20일" (10점) + "반품" (10점) = **30점**
- 제목 매칭: "반품 처리" 포함 = **20점**
- 우선순위: **9점**
- **총점: 59점** → **선택됨! ✅**

### 우선순위의 역할

**Priority는 가산점으로 작동합니다:**
- 키워드 매칭 점수와 함께 합산되어 최종 점수를 결정
- 동일한 키워드 매칭 점수라면 Priority가 높은 항목이 선택됨

**예시:**
- 항목 A: 키워드 20점 + Priority 5 = **25점**
- 항목 B: 키워드 20점 + Priority 9 = **29점** → 항목 B 선택

### 임계점(Threshold)

**최종 점수가 15점 미만이면 AI로 넘깁니다:**
- 키워드 매칭이 거의 없거나 우선순위만으로는 통과 불가
- 15점 이상이어야 로컬 지식베이스에서 답변 제공
- 15점 미만이면 외부 AI(Gemini)로 질문 전달

### 우선순위 설정 전략

1. **높은 우선순위(9-10):**
   - 구체적인 상황별 Case (날짜 포함 등)
   - 자주 묻는 중요한 FAQ
   - 인사/자기소개

2. **중간 우선순위(7-8):**
   - 일반적인 Case
   - 중요한 일반 지식

3. **낮은 우선순위(4-6):**
   - 일반적인 Knowledge
   - 서비스 안내

**팁:** 구체적이고 중요한 항목일수록 높은 우선순위를 부여하세요.

---

## 키워드 작성 팁

### 1. 다양한 표현 포함
```json
"keywords": ["반품", "환불", "환입", "리턴", "반환", "취소"]
```

### 2. 날짜 패턴 포함
```json
"keywords": ["2025년 10월 16일", "10월 16일", "2025-10-16"]
```

### 3. 관련 용어 포함
```json
"keywords": ["수정세금계산서", "수정발급", "수정사유", "마이너스"]
```

---

## 작업 체크리스트

### JSON 파일 수정 시
- [ ] JSON 문법 오류 확인
- [ ] 모든 필수 필드 입력 확인
- [ ] 키워드 다양성 확인
- [ ] 어투별 답변 작성 확인
- [ ] 우선순위 적절성 확인

### Admin 페이지에서 작업 시
- [ ] 변경사항 저장 확인
- [ ] JSON 다운로드로 백업
- [ ] 로컬 서버에서 테스트
- [ ] 챗봇 답변 확인

---

## 문제 해결

### JSON 문법 오류
- JSON 파일을 JSONLint 등으로 검증
- 쉼표(,) 누락 확인
- 따옴표(") 확인

### 챗봇이 답변을 못 찾는 경우
- 키워드 추가 확인
- 우선순위 확인
- 키워드 매칭 점수 확인 (15점 이상 필요)

### FAQ에 표시되지 않는 경우
- `type`이 `"knowledge"` 또는 `"case"`인지 확인
- `category` 필드 확인

---

## 날짜 패턴 추출 및 신고 마감일 계산

### 날짜 패턴 자동 인식

챗봇은 질문에서 날짜를 자동으로 추출하여 답변에 활용합니다.

#### 지원하는 날짜 형식

1. **완전한 날짜 형식:**
   - `2025년 11월 20일`
   - `2025-11-20`
   - `2025/11/20`

2. **월일만 있는 형식 (년도 자동 추정):**
   - `11월 20일` → 현재 년도로 자동 추정
   - `11.20`

3. **상대적 날짜 (향후 지원 예정):**
   - `오늘`, `어제`, `지난주` 등

### 날짜 기반 신고 마감일 계산

부가가치세 신고 마감일은 거래일 기준으로 자동 계산됩니다:

- **1~6월 거래:** 해당 년도 **7월 25일**까지 신고
- **7~12월 거래:** 다음 해 **1월 25일**까지 신고

**예시:**
- 2025년 11월 20일 거래 → 신고 마감일: **2026년 1월 25일**
- 2025년 3월 15일 거래 → 신고 마감일: **2025년 7월 25일**

### JSON에서 날짜 템플릿 사용

날짜가 포함된 질문에 대응하려면 템플릿 방식으로 항목을 작성하세요:

```json
{
  "id": "case_return_date_template",
  "type": "case",
  "category": "수정세금계산서",
  "title": "특정 날짜 거래분 반품 처리",
  "keywords": [
    "반품",
    "환입",
    "거래일",
    "거래분"
  ],
  "dateTemplate": true,
  "priority": 9,
  "responses": {
    "formal": "{date}자 세금계산서의 경우, 해당 세금 신고 마감기한({deadline})이 지나지 않았다면 [환입] 사유로 수정세금계산서를 발행하시면 됩니다.",
    "casual": "{date}에 끊은 거지? 신고 기간({deadline}) 아직 안 지났으면 [환입]으로 다시 끊으면 돼! 🧾"
  }
}
```

### 동적 변수

답변 텍스트에서 다음 변수를 사용할 수 있습니다:

- `{date}`: 추출된 날짜 (예: "2025년 11월 20일")
- `{deadline}`: 계산된 신고 마감일 (예: "2026년 1월 25일")
- `{today}`: 오늘 날짜 (예: "2025년 1월 15일")

### 날짜 패턴 추측 기능

불완전한 날짜 정보도 처리합니다:

- **"11월 거래분"** → 현재 년도 11월로 추정
- **"지난달 거래"** → 이전 달로 추정 (향후 지원)
- **"올해 3월"** → 현재 년도 3월로 추정

**팁:** 자주 묻는 특정 날짜는 키워드에 직접 추가하는 것이 더 정확합니다.

---

## 검색 품질 향상 가이드 (Advanced)

### 1. 오타 방지 및 동의어 확장

사용자의 오타나 애매한 표현까지 잡아내려면 Synonyms에 자주 틀리는 오타도 포함시키세요:

```json
"synonyms": {
  "세금계산서": ["세계서", "계산서", "전자세금계산서", "전세계", "세금계산수", "세금계산"],
  "발급": ["발행", "작성", "만들기", "생성", "발굼", "발급방법"]
}
```

**팁:** 실제 사용자 질문 로그를 분석하여 자주 틀리는 오타를 동의어에 추가하세요.

### 2. 제외 키워드 (Negative Keywords) 활용

특정 단어가 들어갔을 때 절대 이 답변이 나오면 안 되는 경우를 정의합니다:

```json
{
  "id": "knowledge_tax_issuance",
  "type": "knowledge",
  "category": "세금계산서",
  "title": "세금계산서 발급 방법",
  "keywords": ["세금계산서", "발급", "방법", "어떻게"],
  "negativeKeywords": ["취소", "수정", "반품", "환입", "마이너스"],
  "priority": 5,
  "responses": {
    "formal": "..."
  }
}
```

**사용 예시:**
- 질문: "세금계산서 발급 말고 취소 알려줘"
- 결과: "발급 방법" 항목은 `negativeKeywords`에 "취소"가 있어 제외됨
- 대신 "수정세금계산서" 관련 항목이 매칭됨

### 3. 문맥 유지 (Context Awareness)

사용자가 연속된 질문을 할 때 이전 대화 맥락을 기억하도록 합니다.

**구현 방법:**
- 이전 질문의 `category`를 세션에 저장
- 다음 질문 검색 시 해당 카테고리 항목에 가산점 부여

**예시 시나리오:**
1. 사용자: "수정세금계산서 발급 방법은?"
2. 챗봇: "수정세금계산서는..." (category: "수정세금계산서" 저장)
3. 사용자: "그럼 기한은?"
4. 챗봇: "수정세금계산서" 카테고리 내 "기한" 관련 항목 우선 검색

---

## 답변 포맷팅 및 리치 콘텐츠 가이드

### 1. Markdown 문법 활용

답변의 가독성을 높이기 위해 Markdown 문법을 적극 활용하세요:

```json
{
  "responses": {
    "formal": "세금계산서 발급은 **[매출문서 작성]** 메뉴에서 가능합니다.\n\n**발급 절차:**\n1. 바로빌 로그인\n2. '세금계산서 발급' 메뉴 선택\n3. 공급받는자 정보 입력\n\n> ⚠️ **주의사항:** 발급 기한을 반드시 확인하세요.\n\n자세한 내용은 [발급 가이드](https://www.barobill.co.kr/guide/issue)를 참고하세요."
  }
}
```

**주요 문법:**
- **강조:** `**중요한 단어**` → **중요한 단어**
- **리스트:** `- 첫번째`, `1. 첫번째`
- **인용구:** `> 인용 내용`
- **링크:** `[텍스트](URL)`
- **코드:** `` `코드` ``

### 2. 동적 변수 (Dynamic Variables)

답변에 동적으로 변하는 값을 포함할 수 있습니다:

**지원 변수:**
- `{today}`: 오늘 날짜
- `{date}`: 질문에서 추출된 날짜
- `{deadline}`: 신고 마감일

**사용 예시:**
```json
{
  "responses": {
    "formal": "오늘({today}) 기준으로 부가세 신고 기한은 2025년 1월 25일까지입니다."
  }
}
```

### 3. 이미지 및 미디어 활용

복잡한 절차 설명 시 이미지를 활용하세요:

```json
{
  "responses": {
    "formal": "세금계산서 발급 절차:\n\n![발급 버튼 위치](https://www.barobill.co.kr/images/issue-button.png)\n\n위 이미지에서 [매출문서 작성] 버튼을 클릭하세요."
  }
}
```

### 4. 표(Table) 활용

복잡한 정보는 표로 정리하세요:

```json
{
  "responses": {
    "formal": "수정세금계산서 발급 사유:\n\n| 사유 | 작성일자 | 발급건수 |\n|------|----------|----------|\n| 기재사항착오정정 | 원본과 동일 | 2장 |\n| 이중발급 | 착오 인식일 | 1장 |\n| 환입 | 확인일 | 1장 |"
  }
}
```

---

## 피드백 기능 사용 가이드

### 사용자 피드백 제출

1. **메인 페이지 우측 패널**에서 "챗봇 개선 의견" 섹션 확인
2. 피드백 내용 입력
3. "의견 제출" 버튼 클릭
4. 전송 완료 메시지 확인

### 관리자 피드백 관리

1. **Admin 페이지 접근:**
   - `/admin` 경로로 직접 접근
   - 또는 브라우저 주소창에 `http://localhost:8080/admin` 입력

2. **피드백 관리 탭:**
   - "피드백 관리" 탭 클릭
   - 사용자 피드백 목록 확인

3. **피드백 조회:**
   - 작성일시 표시
   - 상태 표시 (대기중/검토완료)
   - 피드백 내용 확인

4. **피드백 삭제:**
   - 각 피드백 항목의 삭제 버튼 클릭
   - 확인 대화상자에서 "확인" 클릭

### 피드백 활용 방법

1. **정기적인 데이터 검토:**
   - 주기적으로 피드백 확인
   - 반복되는 문제점 파악

2. **지식베이스 개선:**
   - 피드백 내용을 바탕으로 키워드 보강
   - 답변 내용 개선
   - 새로운 항목 추가

3. **우선순위 조정:**
   - 자주 묻는 질문의 우선순위 상향 조정

---

## 개선점 및 향후 계획

### 현재 구현된 기능

✅ 기본 키워드 매칭 및 동의어 확장  
✅ 우선순위 기반 점수 계산  
✅ 날짜 패턴 자동 추출  
✅ 신고 마감일 자동 계산  
✅ 동적 변수 치환 ({date}, {deadline}, {today})  
✅ Negative Keywords 필터링  
✅ 피드백 수집 및 관리  
✅ Markdown 기본 지원  

### 향후 개선 계획

#### 1. 검색 품질 향상
- [ ] Fuzzy Matching (오타 보정) - Levenshtein Distance 알고리즘
- [ ] Context Awareness (문맥 유지) - 이전 대화 맥락 기억
- [ ] 자모 단위 분해를 통한 오타 보정

#### 2. 답변 품질 향상
- [ ] Markdown 완전 지원 (이미지, 표 렌더링)
- [ ] Rich Text 확장 (이미지, 동영상)
- [ ] 피드백 루프 (👍/👎) 버튼 추가

#### 3. 날짜 처리 개선
- [ ] 상대적 날짜 처리 ("오늘", "어제", "지난주")
- [ ] 날짜 범위 처리 ("11월 1일부터 20일까지")
- [ ] 공휴일 자동 계산

#### 4. 사용자 경험 개선
- [ ] 대화 내보내기 기능 (텍스트/PDF)
- [ ] 대화 기록 저장
- [ ] 즐겨찾기 질문 기능

#### 5. 관리 기능 강화
- [ ] 피드백 통계 대시보드
- [ ] 자주 묻는 질문 분석
- [ ] 키워드 효과 분석

